{"ast":null,"code":"var _excluded = [\"children\", \"errors\", \"infos\", \"messages\", \"onChange\", \"onReset\", \"onSubmit\", \"onValidate\", \"validate\", \"value\"];\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nimport React, { forwardRef, useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { useAnalytics } from '../../contexts';\nimport { MessageContext } from '../../contexts/MessageContext';\nimport { useForwardedRef } from '../../utils';\nimport { FormContext } from './FormContext';\nimport { FormPropTypes } from './propTypes';\nvar defaultValue = {};\nvar defaultTouched = {};\nvar defaultValidationResults = {\n  errors: {},\n  infos: {}\n};\nvar stringToArray = function stringToArray(string) {\n  var match = string == null ? void 0 : string.match(/^(.+)\\[([0-9]+)\\]\\.(.*)$/);\n  if (match) {\n    var arrayName = match[1],\n      indexOfArray = match[2],\n      arrayObjName = match[3];\n    return {\n      indexOfArray: indexOfArray,\n      arrayName: arrayName,\n      arrayObjName: arrayObjName\n    };\n  }\n  return undefined;\n};\nvar getFieldValue = function getFieldValue(name, value) {\n  var isArrayField = stringToArray(name);\n  if (isArrayField) {\n    var _value$arrayName;\n    var indexOfArray = isArrayField.indexOfArray,\n      arrayName = isArrayField.arrayName,\n      arrayObjName = isArrayField.arrayObjName;\n    var obj = (_value$arrayName = value[arrayName]) == null ? void 0 : _value$arrayName[indexOfArray];\n    return arrayObjName ? obj == null ? void 0 : obj[arrayObjName] : obj;\n  }\n  return value[name];\n};\nvar setFieldValue = function setFieldValue(name, componentValue, prevValue) {\n  var nextValue = _extends({}, prevValue);\n  var isArrayField = stringToArray(name);\n  if (isArrayField) {\n    var indexOfArray = isArrayField.indexOfArray,\n      arrayName = isArrayField.arrayName,\n      arrayObjName = isArrayField.arrayObjName;\n    if (!nextValue[arrayName]) nextValue[arrayName] = [];\n    if (arrayObjName) {\n      var _nextValue$arrayName$;\n      if (!nextValue[arrayName][indexOfArray]) nextValue[arrayName][indexOfArray] = (_nextValue$arrayName$ = {}, _nextValue$arrayName$[arrayObjName] = componentValue, _nextValue$arrayName$);\n      nextValue[arrayName][indexOfArray][arrayObjName] = componentValue;\n    } else nextValue[arrayName][indexOfArray] = componentValue;\n  } else {\n    nextValue[name] = componentValue;\n  }\n  return nextValue;\n};\n\n// Apply validation rule to field value and send correct messaging.\nvar validate = function validate(rule, fieldValue, formValue, format, messages) {\n  var result;\n  if (typeof rule === 'function') {\n    result = rule(fieldValue, formValue);\n  } else if (rule.regexp) {\n    if (!rule.regexp.test(fieldValue)) {\n      result = rule.message || format({\n        id: 'form.invalid',\n        messages: messages\n      });\n      if (rule.status) {\n        result = {\n          message: result,\n          status: rule.status\n        };\n      }\n    }\n  }\n  return result;\n};\n\n// Validates particular key in formValue\nvar validateName = function validateName(validationRules, required) {\n  return function (name, formValue, format, messages) {\n    var fieldValue = getFieldValue(name, formValue);\n    var validationResult;\n    if (required && (\n    // false is for CheckBox\n    fieldValue === undefined || fieldValue === '' || fieldValue === false || Array.isArray(fieldValue) && !fieldValue.length)) {\n      validationResult = format({\n        id: 'form.required',\n        messages: messages\n      });\n    } else if (validationRules) {\n      if (Array.isArray(validationRules)) {\n        validationRules.some(function (rule) {\n          validationResult = validate(rule, fieldValue, formValue, format, messages);\n          return !!validationResult;\n        });\n      } else {\n        validationResult = validate(validationRules, fieldValue, formValue, format, messages);\n      }\n    }\n    return validationResult;\n  };\n};\n\n// Validates all keys in formValue\nvar validateForm = function validateForm(validationRules, formValue, format, messages, omitValid) {\n  var nextErrors = {};\n  var nextInfos = {};\n  validationRules.forEach(function (_ref) {\n    var name = _ref[0],\n      _ref$ = _ref[1],\n      field = _ref$.field,\n      input = _ref$.input;\n    if (!omitValid) {\n      nextErrors[name] = undefined;\n      nextInfos[name] = undefined;\n    }\n    var result;\n    if (input) {\n      // input() a validation function supplied through useFormInput()\n      result = input(name, formValue, format, messages);\n    }\n    if (field && !result) {\n      // field() a validation function supplied through useFormField()\n      result = field(name, formValue, format, messages);\n    }\n    // typeof error === 'object' is implied for both cases of error with\n    // a status message and for an error object that is a react node\n    if (typeof result === 'object') {\n      if (result.status === 'info') {\n        nextInfos[name] = result.message;\n      } else {\n        nextErrors[name] = result.message || result; // could be a node\n      }\n    } else if (typeof result === 'string') {\n      nextErrors[name] = result;\n    }\n  });\n  return [nextErrors, nextInfos];\n};\nvar Form = /*#__PURE__*/forwardRef(function (_ref2, ref) {\n  var children = _ref2.children,\n    _ref2$errors = _ref2.errors,\n    errorsProp = _ref2$errors === void 0 ? defaultValidationResults.errors : _ref2$errors,\n    _ref2$infos = _ref2.infos,\n    infosProp = _ref2$infos === void 0 ? defaultValidationResults.infos : _ref2$infos,\n    messages = _ref2.messages,\n    onChange = _ref2.onChange,\n    _onReset = _ref2.onReset,\n    _onSubmit = _ref2.onSubmit,\n    onValidate = _ref2.onValidate,\n    _ref2$validate = _ref2.validate,\n    validateOn = _ref2$validate === void 0 ? 'submit' : _ref2$validate,\n    valueProp = _ref2.value,\n    rest = _objectWithoutPropertiesLoose(_ref2, _excluded);\n  var formRef = useForwardedRef(ref);\n  var _useContext = useContext(MessageContext),\n    format = _useContext.format;\n  var _useState = useState(valueProp || defaultValue),\n    valueState = _useState[0],\n    setValueState = _useState[1];\n  var value = useMemo(function () {\n    return valueProp || valueState;\n  }, [valueProp, valueState]);\n  var _useState2 = useState(defaultTouched),\n    touched = _useState2[0],\n    setTouched = _useState2[1];\n  var _useState3 = useState({\n      errors: errorsProp,\n      infos: infosProp\n    }),\n    validationResults = _useState3[0],\n    setValidationResults = _useState3[1];\n  // maintain a copy of validationResults in a ref for useEffects\n  // which can't depend on validationResults directly without\n  // causing infinite renders.\n  var validationResultsRef = useRef({});\n  // Simulated onMount state. Consider Form to be mounted once it has\n  // accounted for values originating from controlled inputs (available\n  // at second rendering).\n  var _useState4 = useState('unmounted'),\n    mounted = _useState4[0],\n    setMounted = _useState4[1];\n  useEffect(function () {\n    if (!mounted) setMounted('mounting');else if (mounted === 'mounting') setMounted('mounted');\n  }, [mounted]);\n  // `pendingValidation` is the name of the FormField awaiting validation.\n  var _useState5 = useState(undefined),\n    pendingValidation = _useState5[0],\n    setPendingValidation = _useState5[1];\n  var validationRulesRef = useRef({});\n  var requiredFields = useRef([]);\n  var analyticsRef = useRef({\n    start: new Date(),\n    errors: {}\n  });\n  var sendAnalytics = useAnalytics();\n  var buildValid = useCallback(function (nextErrors) {\n    var valid = false;\n    valid = requiredFields.current.filter(function (n) {\n      return Object.keys(validationRulesRef.current).includes(n);\n    }).every(function (field) {\n      return value[field] && (value[field] !== '' || value[field] !== false);\n    });\n    if (Object.keys(nextErrors).length > 0) valid = false;\n    return valid;\n  }, [value]);\n\n  // Only keep validation results for current form fields. In the case of a\n  // dynamic form, a field possessing an error may have been removed from the\n  // form; need to clean up any previous related validation results.\n  var filterRemovedFields = function filterRemovedFields(prevValidations) {\n    var nextValidations = prevValidations;\n    return Object.keys(nextValidations).filter(function (n) {\n      return !validationRulesRef.current[n] || nextValidations[n] === undefined;\n    }).forEach(function (n) {\n      return delete nextValidations[n];\n    });\n  };\n  var updateAnalytics = function updateAnalytics() {\n    var _validationResultsRef;\n    var errorFields = Object.keys((_validationResultsRef = validationResultsRef.current) == null ? void 0 : _validationResultsRef.errors);\n    var errorCounts = analyticsRef.current.errors;\n    if (errorFields.length > 0) {\n      errorFields.forEach(function (key) {\n        errorCounts[key] = (errorCounts[key] || 0) + 1;\n      });\n    }\n  };\n  var applyValidationRules = useCallback(function (validationRules) {\n    var _validateForm = validateForm(validationRules, value, format, messages),\n      validatedErrors = _validateForm[0],\n      validatedInfos = _validateForm[1];\n    setValidationResults(function (prevValidationResults) {\n      // Keep any previous errors and infos for untouched keys,\n      // these may have come from a Submit.\n      var nextErrors = _extends({}, prevValidationResults.errors, validatedErrors);\n      var nextInfos = _extends({}, prevValidationResults.infos, validatedInfos);\n      // Remove previous errors and infos for keys no longer in the\n      // form, these may have been fields removed from a dynamic form.\n      filterRemovedFields(nextErrors);\n      filterRemovedFields(nextInfos);\n      var nextValidationResults = {\n        errors: nextErrors,\n        infos: nextInfos\n      };\n      if (onValidate) onValidate(_extends({}, nextValidationResults, {\n        valid: buildValid(nextErrors)\n      }));\n      validationResultsRef.current = nextValidationResults;\n      updateAnalytics();\n      return nextValidationResults;\n    });\n  }, [buildValid, format, messages, onValidate, value]);\n\n  // Validate all fields holding values onMount if set to\n  // validate when blur or change.\n  useEffect(function () {\n    var validationRules = Object.entries(validationRulesRef.current);\n    // Use simulated onMount state to account for values provided by\n    // controlled inputs.\n    if (mounted !== 'mounted' && ['blur', 'change'].includes(validateOn) && Object.keys(value).length > 0 && Object.keys(touched).length === 0) {\n      applyValidationRules(validationRules.filter(function (_ref3) {\n        var n = _ref3[0];\n        return value[n];\n      })\n      // Exlude empty arrays which may be initial values in\n      // an input such as DateInput.\n      .filter(function (_ref4) {\n        var n = _ref4[0];\n        return !(Array.isArray(value[n]) && value[n].length === 0);\n      }));\n    }\n  }, [applyValidationRules, mounted, touched, validateOn, value]);\n\n  // Run validation against fields with pendingValidations from onBlur\n  // and/or onChange.\n  useEffect(function () {\n    var validationRules = Object.entries(validationRulesRef.current);\n    var timer = setTimeout(function () {\n      if (pendingValidation && ['blur', 'change'].includes(validateOn)) {\n        applyValidationRules(validationRules.filter(function (_ref5) {\n          var n = _ref5[0];\n          return touched[n] || pendingValidation.includes(n);\n        }));\n        setPendingValidation(undefined);\n      }\n      // Complete any potential click events before running onBlur validation.\n      // Otherwise, click events like reset, etc. may not be registered. For a\n      // detailed scenario/discussion, see: https://github.com/grommet/grommet/issues/4863\n      // Values empirically tested; 120 was selected because it is the largest\n      // Chrome: 100, Safari: 120, Firefox: 80\n    }, 120);\n    return function () {\n      return clearTimeout(timer);\n    };\n  }, [applyValidationRules, pendingValidation, touched, validateOn]);\n\n  // Re-run validation rules for all fields with prior errors.\n  // if validate=blur this helps re-validate if there are errors\n  // as the user fixes them (basically act like validate=change for that)\n  useEffect(function () {\n    var _validationResultsRef2;\n    var validationRules = Object.entries(validationRulesRef.current);\n    if ((_validationResultsRef2 = validationResultsRef.current) != null && _validationResultsRef2.errors && Object.keys(validationResultsRef.current.errors).length > 0) {\n      applyValidationRules(validationRules.filter(function (_ref6) {\n        var n = _ref6[0];\n        return touched[n] && validationResultsRef.current.errors[n];\n      }));\n    }\n  }, [applyValidationRules, touched]);\n  useEffect(function () {\n    var element = formRef.current;\n    analyticsRef.current = {\n      start: new Date(),\n      errors: {}\n    };\n    sendAnalytics({\n      type: 'formOpen',\n      element: element\n    });\n    return function () {\n      if (!analyticsRef.current.submitted) {\n        sendAnalytics({\n          type: 'formClose',\n          element: element,\n          errors: analyticsRef.current.errors,\n          elapsed: new Date().getTime() - analyticsRef.current.start.getTime()\n        });\n      }\n    };\n  }, [sendAnalytics, formRef]);\n\n  // There are three basic patterns of handling form input value state:\n  //\n  // 1 - form controlled\n  //\n  // In this model, the caller sets `value` and `onChange` properties\n  // on the Form component to supply the values used by the input fields.\n  // In useFormContext(), componentValue would be undefined and formValue\n  // is be set to whatever the form state has. Whenever the form state\n  // changes, we update the contextValue so the input component will use\n  // that. When the input component changes, we will call update() to\n  // update the form state.\n  //\n  // 2 - input controlled\n  //\n  // In this model, the caller sets `value` and `onChange` properties\n  // on the input components, like TextInput, to supply the value for it.\n  // In useFormContext(), componentValue is this value and we ensure to\n  // update the form state, via update(), and set the contextValue from\n  // the componentValue. When the input component changes, we will\n  // call update() to update the form state.\n  //\n  // 3 - uncontrolled\n  //\n  // In this model, the caller doesn't set a `value` or `onChange` property\n  // at either the form or input component levels.\n  // In useFormContext(), componentValue is undefined and valueProp is\n  // undefined and nothing much happens here. That is, unless the\n  // calling component needs to know the state in order to work, such\n  // as CheckBox or Select. In this case, those components supply\n  // an initialValue, which will trigger updating the contextValue so\n  // they can have access to it.\n  //\n  var formContextValue = useMemo(function () {\n    var useFormInput = function useFormInput(_ref7) {\n      var name = _ref7.name,\n        componentValue = _ref7.value,\n        initialValue = _ref7.initialValue,\n        validateArg = _ref7.validate;\n      var _useState6 = useState(initialValue),\n        inputValue = _useState6[0],\n        setInputValue = _useState6[1];\n      var formValue = name ? getFieldValue(name, value) : undefined;\n      // for dynamic forms, we need to track when an input has been added to\n      // the form value. if the input is unmounted, we will delete its\n      // key/value from the form value.\n      var keyCreated = useRef(false);\n\n      // This effect is for pattern #2, where the controlled input\n      // component is driving the value via componentValue.\n      useEffect(function () {\n        if (name &&\n        // we have somewhere to put this\n        componentValue !== undefined &&\n        // input driving\n        componentValue !== formValue // don't already have it\n        ) {\n          setValueState(function (prevValue) {\n            return setFieldValue(name, componentValue, prevValue);\n          });\n          // don't onChange on programmatic changes\n        }\n      }, [componentValue, formValue, name]);\n\n      // on unmount, if the form is uncontrolled, remove the key/value\n      // from the form value\n      useEffect(function () {\n        return function () {\n          if (keyCreated.current) {\n            keyCreated.current = false;\n            setValueState(function (prevValue) {\n              var nextValue = _extends({}, prevValue);\n              var isArrayField = stringToArray(name);\n              if (isArrayField) {\n                var arrayName = isArrayField.arrayName;\n                delete nextValue[arrayName];\n              } else {\n                delete nextValue[name];\n              }\n              return nextValue;\n            });\n          }\n        };\n      },\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [] // only run onmount and unmount\n      );\n\n      // Create validation rules for fields\n      useEffect(function () {\n        if (validateArg) {\n          if (!validationRulesRef.current[name]) {\n            validationRulesRef.current[name] = {};\n          }\n          validationRulesRef.current[name].input = validateName(validateArg);\n          return function () {\n            return delete validationRulesRef.current[name].input;\n          };\n        }\n        return undefined;\n      }, [validateArg, name]);\n      var useValue;\n      if (componentValue !== undefined)\n        // input component drives, pattern #2\n        useValue = componentValue;else if (valueProp && name && formValue !== undefined)\n        // form drives, pattern #1\n        useValue = formValue;else if (formValue === undefined && name)\n        // form has reset, so reset input value as well\n        useValue = initialValue;else useValue = inputValue;\n      return [useValue, function (nextComponentValue) {\n        if (name) {\n          // we have somewhere to put this\n          var nextTouched = _extends({}, touched);\n          nextTouched[name] = true;\n          if (!touched[name]) {\n            // don't update if not needed\n            setTouched(nextTouched);\n          }\n\n          // if nextValue doesn't have a key for name, this must be\n          // uncontrolled form. we will flag this field was added so\n          // we know to remove its value from the form if it is dynamically\n          // removed\n          if (!(name in value)) keyCreated.current = true;\n          var nextValue = setFieldValue(name, nextComponentValue, value);\n          setValueState(nextValue);\n          if (onChange) onChange(nextValue, {\n            touched: nextTouched\n          });\n        }\n        if (initialValue !== undefined) setInputValue(nextComponentValue);\n      }];\n    };\n    var useFormField = function useFormField(_ref8) {\n      var errorArg = _ref8.error,\n        infoArg = _ref8.info,\n        name = _ref8.name,\n        required = _ref8.required,\n        disabled = _ref8.disabled,\n        validateArg = _ref8.validate;\n      var error = disabled ? undefined : errorArg || validationResults.errors[name];\n      var info = infoArg || validationResults.infos[name];\n\n      // Create validation rules for field\n      useEffect(function () {\n        var index = requiredFields.current.indexOf(name);\n        if (required) {\n          if (index === -1) requiredFields.current.push(name);\n        } else if (index !== -1) requiredFields.current.splice(index, 1);\n        if (validateArg || required) {\n          if (!validationRulesRef.current[name]) {\n            validationRulesRef.current[name] = {};\n          }\n          validationRulesRef.current[name].field = validateName(validateArg, required);\n          return function () {\n            delete validationRulesRef.current[name].field;\n            var requiredFieldIndex = requiredFields.current.indexOf(name);\n            if (requiredFieldIndex !== -1) {\n              requiredFields.current.splice(requiredFieldIndex, 1);\n            }\n          };\n        }\n        return undefined;\n      }, [error, name, required, validateArg, disabled]);\n      return {\n        error: error,\n        info: info,\n        inForm: true,\n        onBlur: validateOn === 'blur' ? function () {\n          return setPendingValidation(pendingValidation ? [].concat(pendingValidation, [name]) : [name]);\n        } : undefined,\n        onChange: validateOn === 'change' ? function () {\n          return setPendingValidation(pendingValidation ? [].concat(pendingValidation, [name]) : [name]);\n        } : undefined\n      };\n    };\n    return {\n      useFormField: useFormField,\n      useFormInput: useFormInput\n    };\n  }, [onChange, pendingValidation, touched, validateOn, validationResults.errors, validationResults.infos, value, valueProp]);\n  return /*#__PURE__*/React.createElement(\"form\", _extends({\n    ref: formRef\n  }, rest, {\n    onReset: function onReset(event) {\n      sendAnalytics({\n        type: 'formReset',\n        element: formRef.current,\n        data: event,\n        errors: analyticsRef.current.errors,\n        elapsed: new Date().getTime() - analyticsRef.current.start.getTime()\n      });\n      setPendingValidation(undefined);\n      if (!valueProp) {\n        setValueState(defaultValue);\n        if (onChange) onChange(defaultValue, {\n          touched: defaultTouched\n        });\n      }\n      setTouched(defaultTouched);\n      setValidationResults(defaultValidationResults);\n      analyticsRef.current = {\n        start: new Date(),\n        errors: {}\n      };\n      if (_onReset) {\n        event.persist(); // extract from React's synthetic event pool\n        var adjustedEvent = event;\n        adjustedEvent.value = defaultValue;\n        _onReset(adjustedEvent);\n      }\n    },\n    onSubmit: function onSubmit(event) {\n      // Don't submit the form via browser form action. We don't want it\n      // if the validation fails. And, we assume a javascript action handler\n      // otherwise.\n      event.preventDefault();\n      setPendingValidation(undefined);\n      var _validateForm2 = validateForm(Object.entries(validationRulesRef.current), value, format, messages, true),\n        nextErrors = _validateForm2[0],\n        nextInfos = _validateForm2[1];\n      setValidationResults(function () {\n        var nextValidationResults = {\n          errors: nextErrors,\n          infos: nextInfos,\n          // Show form's validity when clicking on Submit\n          valid: buildValid(nextErrors)\n        };\n        if (onValidate) onValidate(nextValidationResults);\n        validationResultsRef.current = nextValidationResults;\n        updateAnalytics();\n        return nextValidationResults;\n      });\n      if (Object.keys(nextErrors).length === 0 && _onSubmit) {\n        event.persist(); // extract from React's synthetic event pool\n        var adjustedEvent = event;\n        adjustedEvent.value = value;\n        adjustedEvent.touched = touched;\n        _onSubmit(adjustedEvent);\n        sendAnalytics({\n          type: 'formSubmit',\n          element: formRef.current,\n          data: adjustedEvent,\n          errors: analyticsRef.current.errors,\n          elapsed: new Date().getTime() - analyticsRef.current.start.getTime()\n        });\n        analyticsRef.current.errors = {};\n        analyticsRef.current.submitted = true;\n      }\n    }\n  }), /*#__PURE__*/React.createElement(FormContext.Provider, {\n    value: formContextValue\n  }, children));\n});\nForm.displayName = 'Form';\nForm.propTypes = FormPropTypes;\nexport { Form };","map":{"version":3,"names":["_excluded","_objectWithoutPropertiesLoose","source","excluded","target","sourceKeys","Object","keys","key","i","length","indexOf","_extends","assign","bind","arguments","prototype","hasOwnProperty","call","apply","React","forwardRef","useCallback","useContext","useEffect","useMemo","useRef","useState","useAnalytics","MessageContext","useForwardedRef","FormContext","FormPropTypes","defaultValue","defaultTouched","defaultValidationResults","errors","infos","stringToArray","string","match","arrayName","indexOfArray","arrayObjName","undefined","getFieldValue","name","value","isArrayField","_value$arrayName","obj","setFieldValue","componentValue","prevValue","nextValue","_nextValue$arrayName$","validate","rule","fieldValue","formValue","format","messages","result","regexp","test","message","id","status","validateName","validationRules","required","validationResult","Array","isArray","some","validateForm","omitValid","nextErrors","nextInfos","forEach","_ref","_ref$","field","input","Form","_ref2","ref","children","_ref2$errors","errorsProp","_ref2$infos","infosProp","onChange","_onReset","onReset","_onSubmit","onSubmit","onValidate","_ref2$validate","validateOn","valueProp","rest","formRef","_useContext","_useState","valueState","setValueState","_useState2","touched","setTouched","_useState3","validationResults","setValidationResults","validationResultsRef","_useState4","mounted","setMounted","_useState5","pendingValidation","setPendingValidation","validationRulesRef","requiredFields","analyticsRef","start","Date","sendAnalytics","buildValid","valid","current","filter","n","includes","every","filterRemovedFields","prevValidations","nextValidations","updateAnalytics","_validationResultsRef","errorFields","errorCounts","applyValidationRules","_validateForm","validatedErrors","validatedInfos","prevValidationResults","nextValidationResults","entries","_ref3","_ref4","timer","setTimeout","_ref5","clearTimeout","_validationResultsRef2","_ref6","element","type","submitted","elapsed","getTime","formContextValue","useFormInput","_ref7","initialValue","validateArg","_useState6","inputValue","setInputValue","keyCreated","useValue","nextComponentValue","nextTouched","useFormField","_ref8","errorArg","error","infoArg","info","disabled","index","push","splice","requiredFieldIndex","inForm","onBlur","concat","createElement","event","data","persist","adjustedEvent","preventDefault","_validateForm2","Provider","displayName","propTypes"],"sources":["C:/Users/archi/OneDrive/Documents/Uni/Udemy React Course/first-react-app/node_modules/grommet/es6/components/Form/Form.js"],"sourcesContent":["var _excluded = [\"children\", \"errors\", \"infos\", \"messages\", \"onChange\", \"onReset\", \"onSubmit\", \"onValidate\", \"validate\", \"value\"];\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport React, { forwardRef, useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { useAnalytics } from '../../contexts';\nimport { MessageContext } from '../../contexts/MessageContext';\nimport { useForwardedRef } from '../../utils';\nimport { FormContext } from './FormContext';\nimport { FormPropTypes } from './propTypes';\nvar defaultValue = {};\nvar defaultTouched = {};\nvar defaultValidationResults = {\n  errors: {},\n  infos: {}\n};\nvar stringToArray = function stringToArray(string) {\n  var match = string == null ? void 0 : string.match(/^(.+)\\[([0-9]+)\\]\\.(.*)$/);\n  if (match) {\n    var arrayName = match[1],\n      indexOfArray = match[2],\n      arrayObjName = match[3];\n    return {\n      indexOfArray: indexOfArray,\n      arrayName: arrayName,\n      arrayObjName: arrayObjName\n    };\n  }\n  return undefined;\n};\nvar getFieldValue = function getFieldValue(name, value) {\n  var isArrayField = stringToArray(name);\n  if (isArrayField) {\n    var _value$arrayName;\n    var indexOfArray = isArrayField.indexOfArray,\n      arrayName = isArrayField.arrayName,\n      arrayObjName = isArrayField.arrayObjName;\n    var obj = (_value$arrayName = value[arrayName]) == null ? void 0 : _value$arrayName[indexOfArray];\n    return arrayObjName ? obj == null ? void 0 : obj[arrayObjName] : obj;\n  }\n  return value[name];\n};\nvar setFieldValue = function setFieldValue(name, componentValue, prevValue) {\n  var nextValue = _extends({}, prevValue);\n  var isArrayField = stringToArray(name);\n  if (isArrayField) {\n    var indexOfArray = isArrayField.indexOfArray,\n      arrayName = isArrayField.arrayName,\n      arrayObjName = isArrayField.arrayObjName;\n    if (!nextValue[arrayName]) nextValue[arrayName] = [];\n    if (arrayObjName) {\n      var _nextValue$arrayName$;\n      if (!nextValue[arrayName][indexOfArray]) nextValue[arrayName][indexOfArray] = (_nextValue$arrayName$ = {}, _nextValue$arrayName$[arrayObjName] = componentValue, _nextValue$arrayName$);\n      nextValue[arrayName][indexOfArray][arrayObjName] = componentValue;\n    } else nextValue[arrayName][indexOfArray] = componentValue;\n  } else {\n    nextValue[name] = componentValue;\n  }\n  return nextValue;\n};\n\n// Apply validation rule to field value and send correct messaging.\nvar validate = function validate(rule, fieldValue, formValue, format, messages) {\n  var result;\n  if (typeof rule === 'function') {\n    result = rule(fieldValue, formValue);\n  } else if (rule.regexp) {\n    if (!rule.regexp.test(fieldValue)) {\n      result = rule.message || format({\n        id: 'form.invalid',\n        messages: messages\n      });\n      if (rule.status) {\n        result = {\n          message: result,\n          status: rule.status\n        };\n      }\n    }\n  }\n  return result;\n};\n\n// Validates particular key in formValue\nvar validateName = function validateName(validationRules, required) {\n  return function (name, formValue, format, messages) {\n    var fieldValue = getFieldValue(name, formValue);\n    var validationResult;\n    if (required && (\n    // false is for CheckBox\n    fieldValue === undefined || fieldValue === '' || fieldValue === false || Array.isArray(fieldValue) && !fieldValue.length)) {\n      validationResult = format({\n        id: 'form.required',\n        messages: messages\n      });\n    } else if (validationRules) {\n      if (Array.isArray(validationRules)) {\n        validationRules.some(function (rule) {\n          validationResult = validate(rule, fieldValue, formValue, format, messages);\n          return !!validationResult;\n        });\n      } else {\n        validationResult = validate(validationRules, fieldValue, formValue, format, messages);\n      }\n    }\n    return validationResult;\n  };\n};\n\n// Validates all keys in formValue\nvar validateForm = function validateForm(validationRules, formValue, format, messages, omitValid) {\n  var nextErrors = {};\n  var nextInfos = {};\n  validationRules.forEach(function (_ref) {\n    var name = _ref[0],\n      _ref$ = _ref[1],\n      field = _ref$.field,\n      input = _ref$.input;\n    if (!omitValid) {\n      nextErrors[name] = undefined;\n      nextInfos[name] = undefined;\n    }\n    var result;\n    if (input) {\n      // input() a validation function supplied through useFormInput()\n      result = input(name, formValue, format, messages);\n    }\n    if (field && !result) {\n      // field() a validation function supplied through useFormField()\n      result = field(name, formValue, format, messages);\n    }\n    // typeof error === 'object' is implied for both cases of error with\n    // a status message and for an error object that is a react node\n    if (typeof result === 'object') {\n      if (result.status === 'info') {\n        nextInfos[name] = result.message;\n      } else {\n        nextErrors[name] = result.message || result; // could be a node\n      }\n    } else if (typeof result === 'string') {\n      nextErrors[name] = result;\n    }\n  });\n  return [nextErrors, nextInfos];\n};\nvar Form = /*#__PURE__*/forwardRef(function (_ref2, ref) {\n  var children = _ref2.children,\n    _ref2$errors = _ref2.errors,\n    errorsProp = _ref2$errors === void 0 ? defaultValidationResults.errors : _ref2$errors,\n    _ref2$infos = _ref2.infos,\n    infosProp = _ref2$infos === void 0 ? defaultValidationResults.infos : _ref2$infos,\n    messages = _ref2.messages,\n    onChange = _ref2.onChange,\n    _onReset = _ref2.onReset,\n    _onSubmit = _ref2.onSubmit,\n    onValidate = _ref2.onValidate,\n    _ref2$validate = _ref2.validate,\n    validateOn = _ref2$validate === void 0 ? 'submit' : _ref2$validate,\n    valueProp = _ref2.value,\n    rest = _objectWithoutPropertiesLoose(_ref2, _excluded);\n  var formRef = useForwardedRef(ref);\n  var _useContext = useContext(MessageContext),\n    format = _useContext.format;\n  var _useState = useState(valueProp || defaultValue),\n    valueState = _useState[0],\n    setValueState = _useState[1];\n  var value = useMemo(function () {\n    return valueProp || valueState;\n  }, [valueProp, valueState]);\n  var _useState2 = useState(defaultTouched),\n    touched = _useState2[0],\n    setTouched = _useState2[1];\n  var _useState3 = useState({\n      errors: errorsProp,\n      infos: infosProp\n    }),\n    validationResults = _useState3[0],\n    setValidationResults = _useState3[1];\n  // maintain a copy of validationResults in a ref for useEffects\n  // which can't depend on validationResults directly without\n  // causing infinite renders.\n  var validationResultsRef = useRef({});\n  // Simulated onMount state. Consider Form to be mounted once it has\n  // accounted for values originating from controlled inputs (available\n  // at second rendering).\n  var _useState4 = useState('unmounted'),\n    mounted = _useState4[0],\n    setMounted = _useState4[1];\n  useEffect(function () {\n    if (!mounted) setMounted('mounting');else if (mounted === 'mounting') setMounted('mounted');\n  }, [mounted]);\n  // `pendingValidation` is the name of the FormField awaiting validation.\n  var _useState5 = useState(undefined),\n    pendingValidation = _useState5[0],\n    setPendingValidation = _useState5[1];\n  var validationRulesRef = useRef({});\n  var requiredFields = useRef([]);\n  var analyticsRef = useRef({\n    start: new Date(),\n    errors: {}\n  });\n  var sendAnalytics = useAnalytics();\n  var buildValid = useCallback(function (nextErrors) {\n    var valid = false;\n    valid = requiredFields.current.filter(function (n) {\n      return Object.keys(validationRulesRef.current).includes(n);\n    }).every(function (field) {\n      return value[field] && (value[field] !== '' || value[field] !== false);\n    });\n    if (Object.keys(nextErrors).length > 0) valid = false;\n    return valid;\n  }, [value]);\n\n  // Only keep validation results for current form fields. In the case of a\n  // dynamic form, a field possessing an error may have been removed from the\n  // form; need to clean up any previous related validation results.\n  var filterRemovedFields = function filterRemovedFields(prevValidations) {\n    var nextValidations = prevValidations;\n    return Object.keys(nextValidations).filter(function (n) {\n      return !validationRulesRef.current[n] || nextValidations[n] === undefined;\n    }).forEach(function (n) {\n      return delete nextValidations[n];\n    });\n  };\n  var updateAnalytics = function updateAnalytics() {\n    var _validationResultsRef;\n    var errorFields = Object.keys((_validationResultsRef = validationResultsRef.current) == null ? void 0 : _validationResultsRef.errors);\n    var errorCounts = analyticsRef.current.errors;\n    if (errorFields.length > 0) {\n      errorFields.forEach(function (key) {\n        errorCounts[key] = (errorCounts[key] || 0) + 1;\n      });\n    }\n  };\n  var applyValidationRules = useCallback(function (validationRules) {\n    var _validateForm = validateForm(validationRules, value, format, messages),\n      validatedErrors = _validateForm[0],\n      validatedInfos = _validateForm[1];\n    setValidationResults(function (prevValidationResults) {\n      // Keep any previous errors and infos for untouched keys,\n      // these may have come from a Submit.\n      var nextErrors = _extends({}, prevValidationResults.errors, validatedErrors);\n      var nextInfos = _extends({}, prevValidationResults.infos, validatedInfos);\n      // Remove previous errors and infos for keys no longer in the\n      // form, these may have been fields removed from a dynamic form.\n      filterRemovedFields(nextErrors);\n      filterRemovedFields(nextInfos);\n      var nextValidationResults = {\n        errors: nextErrors,\n        infos: nextInfos\n      };\n      if (onValidate) onValidate(_extends({}, nextValidationResults, {\n        valid: buildValid(nextErrors)\n      }));\n      validationResultsRef.current = nextValidationResults;\n      updateAnalytics();\n      return nextValidationResults;\n    });\n  }, [buildValid, format, messages, onValidate, value]);\n\n  // Validate all fields holding values onMount if set to\n  // validate when blur or change.\n  useEffect(function () {\n    var validationRules = Object.entries(validationRulesRef.current);\n    // Use simulated onMount state to account for values provided by\n    // controlled inputs.\n    if (mounted !== 'mounted' && ['blur', 'change'].includes(validateOn) && Object.keys(value).length > 0 && Object.keys(touched).length === 0) {\n      applyValidationRules(validationRules.filter(function (_ref3) {\n        var n = _ref3[0];\n        return value[n];\n      })\n      // Exlude empty arrays which may be initial values in\n      // an input such as DateInput.\n      .filter(function (_ref4) {\n        var n = _ref4[0];\n        return !(Array.isArray(value[n]) && value[n].length === 0);\n      }));\n    }\n  }, [applyValidationRules, mounted, touched, validateOn, value]);\n\n  // Run validation against fields with pendingValidations from onBlur\n  // and/or onChange.\n  useEffect(function () {\n    var validationRules = Object.entries(validationRulesRef.current);\n    var timer = setTimeout(function () {\n      if (pendingValidation && ['blur', 'change'].includes(validateOn)) {\n        applyValidationRules(validationRules.filter(function (_ref5) {\n          var n = _ref5[0];\n          return touched[n] || pendingValidation.includes(n);\n        }));\n        setPendingValidation(undefined);\n      }\n      // Complete any potential click events before running onBlur validation.\n      // Otherwise, click events like reset, etc. may not be registered. For a\n      // detailed scenario/discussion, see: https://github.com/grommet/grommet/issues/4863\n      // Values empirically tested; 120 was selected because it is the largest\n      // Chrome: 100, Safari: 120, Firefox: 80\n    }, 120);\n    return function () {\n      return clearTimeout(timer);\n    };\n  }, [applyValidationRules, pendingValidation, touched, validateOn]);\n\n  // Re-run validation rules for all fields with prior errors.\n  // if validate=blur this helps re-validate if there are errors\n  // as the user fixes them (basically act like validate=change for that)\n  useEffect(function () {\n    var _validationResultsRef2;\n    var validationRules = Object.entries(validationRulesRef.current);\n    if ((_validationResultsRef2 = validationResultsRef.current) != null && _validationResultsRef2.errors && Object.keys(validationResultsRef.current.errors).length > 0) {\n      applyValidationRules(validationRules.filter(function (_ref6) {\n        var n = _ref6[0];\n        return touched[n] && validationResultsRef.current.errors[n];\n      }));\n    }\n  }, [applyValidationRules, touched]);\n  useEffect(function () {\n    var element = formRef.current;\n    analyticsRef.current = {\n      start: new Date(),\n      errors: {}\n    };\n    sendAnalytics({\n      type: 'formOpen',\n      element: element\n    });\n    return function () {\n      if (!analyticsRef.current.submitted) {\n        sendAnalytics({\n          type: 'formClose',\n          element: element,\n          errors: analyticsRef.current.errors,\n          elapsed: new Date().getTime() - analyticsRef.current.start.getTime()\n        });\n      }\n    };\n  }, [sendAnalytics, formRef]);\n\n  // There are three basic patterns of handling form input value state:\n  //\n  // 1 - form controlled\n  //\n  // In this model, the caller sets `value` and `onChange` properties\n  // on the Form component to supply the values used by the input fields.\n  // In useFormContext(), componentValue would be undefined and formValue\n  // is be set to whatever the form state has. Whenever the form state\n  // changes, we update the contextValue so the input component will use\n  // that. When the input component changes, we will call update() to\n  // update the form state.\n  //\n  // 2 - input controlled\n  //\n  // In this model, the caller sets `value` and `onChange` properties\n  // on the input components, like TextInput, to supply the value for it.\n  // In useFormContext(), componentValue is this value and we ensure to\n  // update the form state, via update(), and set the contextValue from\n  // the componentValue. When the input component changes, we will\n  // call update() to update the form state.\n  //\n  // 3 - uncontrolled\n  //\n  // In this model, the caller doesn't set a `value` or `onChange` property\n  // at either the form or input component levels.\n  // In useFormContext(), componentValue is undefined and valueProp is\n  // undefined and nothing much happens here. That is, unless the\n  // calling component needs to know the state in order to work, such\n  // as CheckBox or Select. In this case, those components supply\n  // an initialValue, which will trigger updating the contextValue so\n  // they can have access to it.\n  //\n  var formContextValue = useMemo(function () {\n    var useFormInput = function useFormInput(_ref7) {\n      var name = _ref7.name,\n        componentValue = _ref7.value,\n        initialValue = _ref7.initialValue,\n        validateArg = _ref7.validate;\n      var _useState6 = useState(initialValue),\n        inputValue = _useState6[0],\n        setInputValue = _useState6[1];\n      var formValue = name ? getFieldValue(name, value) : undefined;\n      // for dynamic forms, we need to track when an input has been added to\n      // the form value. if the input is unmounted, we will delete its\n      // key/value from the form value.\n      var keyCreated = useRef(false);\n\n      // This effect is for pattern #2, where the controlled input\n      // component is driving the value via componentValue.\n      useEffect(function () {\n        if (name &&\n        // we have somewhere to put this\n        componentValue !== undefined &&\n        // input driving\n        componentValue !== formValue // don't already have it\n        ) {\n          setValueState(function (prevValue) {\n            return setFieldValue(name, componentValue, prevValue);\n          });\n          // don't onChange on programmatic changes\n        }\n      }, [componentValue, formValue, name]);\n\n      // on unmount, if the form is uncontrolled, remove the key/value\n      // from the form value\n      useEffect(function () {\n        return function () {\n          if (keyCreated.current) {\n            keyCreated.current = false;\n            setValueState(function (prevValue) {\n              var nextValue = _extends({}, prevValue);\n              var isArrayField = stringToArray(name);\n              if (isArrayField) {\n                var arrayName = isArrayField.arrayName;\n                delete nextValue[arrayName];\n              } else {\n                delete nextValue[name];\n              }\n              return nextValue;\n            });\n          }\n        };\n      },\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [] // only run onmount and unmount\n      );\n\n      // Create validation rules for fields\n      useEffect(function () {\n        if (validateArg) {\n          if (!validationRulesRef.current[name]) {\n            validationRulesRef.current[name] = {};\n          }\n          validationRulesRef.current[name].input = validateName(validateArg);\n          return function () {\n            return delete validationRulesRef.current[name].input;\n          };\n        }\n        return undefined;\n      }, [validateArg, name]);\n      var useValue;\n      if (componentValue !== undefined)\n        // input component drives, pattern #2\n        useValue = componentValue;else if (valueProp && name && formValue !== undefined)\n        // form drives, pattern #1\n        useValue = formValue;else if (formValue === undefined && name)\n        // form has reset, so reset input value as well\n        useValue = initialValue;else useValue = inputValue;\n      return [useValue, function (nextComponentValue) {\n        if (name) {\n          // we have somewhere to put this\n          var nextTouched = _extends({}, touched);\n          nextTouched[name] = true;\n          if (!touched[name]) {\n            // don't update if not needed\n            setTouched(nextTouched);\n          }\n\n          // if nextValue doesn't have a key for name, this must be\n          // uncontrolled form. we will flag this field was added so\n          // we know to remove its value from the form if it is dynamically\n          // removed\n          if (!(name in value)) keyCreated.current = true;\n          var nextValue = setFieldValue(name, nextComponentValue, value);\n          setValueState(nextValue);\n          if (onChange) onChange(nextValue, {\n            touched: nextTouched\n          });\n        }\n        if (initialValue !== undefined) setInputValue(nextComponentValue);\n      }];\n    };\n    var useFormField = function useFormField(_ref8) {\n      var errorArg = _ref8.error,\n        infoArg = _ref8.info,\n        name = _ref8.name,\n        required = _ref8.required,\n        disabled = _ref8.disabled,\n        validateArg = _ref8.validate;\n      var error = disabled ? undefined : errorArg || validationResults.errors[name];\n      var info = infoArg || validationResults.infos[name];\n\n      // Create validation rules for field\n      useEffect(function () {\n        var index = requiredFields.current.indexOf(name);\n        if (required) {\n          if (index === -1) requiredFields.current.push(name);\n        } else if (index !== -1) requiredFields.current.splice(index, 1);\n        if (validateArg || required) {\n          if (!validationRulesRef.current[name]) {\n            validationRulesRef.current[name] = {};\n          }\n          validationRulesRef.current[name].field = validateName(validateArg, required);\n          return function () {\n            delete validationRulesRef.current[name].field;\n            var requiredFieldIndex = requiredFields.current.indexOf(name);\n            if (requiredFieldIndex !== -1) {\n              requiredFields.current.splice(requiredFieldIndex, 1);\n            }\n          };\n        }\n        return undefined;\n      }, [error, name, required, validateArg, disabled]);\n      return {\n        error: error,\n        info: info,\n        inForm: true,\n        onBlur: validateOn === 'blur' ? function () {\n          return setPendingValidation(pendingValidation ? [].concat(pendingValidation, [name]) : [name]);\n        } : undefined,\n        onChange: validateOn === 'change' ? function () {\n          return setPendingValidation(pendingValidation ? [].concat(pendingValidation, [name]) : [name]);\n        } : undefined\n      };\n    };\n    return {\n      useFormField: useFormField,\n      useFormInput: useFormInput\n    };\n  }, [onChange, pendingValidation, touched, validateOn, validationResults.errors, validationResults.infos, value, valueProp]);\n  return /*#__PURE__*/React.createElement(\"form\", _extends({\n    ref: formRef\n  }, rest, {\n    onReset: function onReset(event) {\n      sendAnalytics({\n        type: 'formReset',\n        element: formRef.current,\n        data: event,\n        errors: analyticsRef.current.errors,\n        elapsed: new Date().getTime() - analyticsRef.current.start.getTime()\n      });\n      setPendingValidation(undefined);\n      if (!valueProp) {\n        setValueState(defaultValue);\n        if (onChange) onChange(defaultValue, {\n          touched: defaultTouched\n        });\n      }\n      setTouched(defaultTouched);\n      setValidationResults(defaultValidationResults);\n      analyticsRef.current = {\n        start: new Date(),\n        errors: {}\n      };\n      if (_onReset) {\n        event.persist(); // extract from React's synthetic event pool\n        var adjustedEvent = event;\n        adjustedEvent.value = defaultValue;\n        _onReset(adjustedEvent);\n      }\n    },\n    onSubmit: function onSubmit(event) {\n      // Don't submit the form via browser form action. We don't want it\n      // if the validation fails. And, we assume a javascript action handler\n      // otherwise.\n      event.preventDefault();\n      setPendingValidation(undefined);\n      var _validateForm2 = validateForm(Object.entries(validationRulesRef.current), value, format, messages, true),\n        nextErrors = _validateForm2[0],\n        nextInfos = _validateForm2[1];\n      setValidationResults(function () {\n        var nextValidationResults = {\n          errors: nextErrors,\n          infos: nextInfos,\n          // Show form's validity when clicking on Submit\n          valid: buildValid(nextErrors)\n        };\n        if (onValidate) onValidate(nextValidationResults);\n        validationResultsRef.current = nextValidationResults;\n        updateAnalytics();\n        return nextValidationResults;\n      });\n      if (Object.keys(nextErrors).length === 0 && _onSubmit) {\n        event.persist(); // extract from React's synthetic event pool\n        var adjustedEvent = event;\n        adjustedEvent.value = value;\n        adjustedEvent.touched = touched;\n        _onSubmit(adjustedEvent);\n        sendAnalytics({\n          type: 'formSubmit',\n          element: formRef.current,\n          data: adjustedEvent,\n          errors: analyticsRef.current.errors,\n          elapsed: new Date().getTime() - analyticsRef.current.start.getTime()\n        });\n        analyticsRef.current.errors = {};\n        analyticsRef.current.submitted = true;\n      }\n    }\n  }), /*#__PURE__*/React.createElement(FormContext.Provider, {\n    value: formContextValue\n  }, children));\n});\nForm.displayName = 'Form';\nForm.propTypes = FormPropTypes;\nexport { Form };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}